<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <title>Configuración del Sistema</title>
    <style>
        table {
            border-collapse: collapse;
            width: 100%;
        }

        th,
        td {
            border: 1px solid #bbb;
            padding: 0.5em;
        }

        tr.inactivo {
            background: #eee;
        }

        tr.bloqueado {
            background: #fcc;
        }

        .actions {
            white-space: nowrap;
        }
    </style>
</head>

<body>
    <h1>Configuración General</h1>

    <form method="get" action="/configuracion">
        <input type="text" name="q" placeholder="Buscar clave..." value="{{ q or '' }}">
        <select name="status">
            <option value="">(Todos)</option>
            <option value="activo" {% if status=='activo' %}selected{% endif %}>Activo</option>
            <option value="inactivo" {% if status=='inactivo' %}selected{% endif %}>Inactivo</option>
            <option value="bloqueado" {% if status=='bloqueado' %}selected{% endif %}>Bloqueado</option>
        </select>
        <button type="submit">Buscar/Filtrar</button>
    </form>

    <form method="post" action="/sincronizar-config" style="margin-top:1em;">
        <button type="submit">🔄 Sincronizar categorías, marcas y series desde WooCommerce</button>
    </form>

    <h2>Crear nueva configuración</h2>
    <form method="post" action="/crear-config" style="margin-bottom:2em;">
        <input type="text" name="key" placeholder="Clave (ej: plantilla_no_manejamos)" required>
        <input type="text" name="value" placeholder="Valor" required>
        <select name="status">
            <option value="activo">Activo</option>
            <option value="inactivo">Inactivo</option>
            <option value="bloqueado">Bloqueado</option>
        </select>
        <input type="text" name="descripcion" placeholder="Descripción">
        <button type="submit">Crear</button>
    </form>

    <table>
        <tr>
            <th>ID</th>
            <th>Clave</th>
            <th>Valor</th>
            <th>Status</th>
            <th>Descripción</th>
            <th>Creado</th>
            <th>Modificado</th>
            <th>Editar</th>
        </tr>
        {% for c in config %}
        <tr class="{{ c.status }}">
            <form method="post" action="/update-config">
                <td>{{ c.id }}</td>
                <td>{{ c.key }}</td>
                <td>
                    <textarea name="value" rows="2" cols="24">{{ c.value }}</textarea>
                </td>
                <td>
                    <select name="status">
                        <option value="activo" {% if c.status=='activo' %}selected{% endif %}>Activo</option>
                        <option value="inactivo" {% if c.status=='inactivo' %}selected{% endif %}>Inactivo</option>
                        <option value="bloqueado" {% if c.status=='bloqueado' %}selected{% endif %}>Bloqueado</option>
                    </select>
                </td>
                <td>
                    <input type="text" name="descripcion" value="{{ c.descripcion or '' }}" size="18">
                </td>
                <td>{{ c.created_at.strftime("%Y-%m-%d %H:%M") }}</td>
                <td>{{ c.updated_at.strftime("%Y-%m-%d %H:%M") }}</td>
                <td class="actions">
                    <input type="hidden" name="id" value="{{ c.id }}">
                    <button type="submit">💾</button>
                </td>
            </form>
        </tr>
        {% endfor %}
    </table>

</body>

</html>